// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: batch_log.sql

package generated

import (
	"context"
	"database/sql"
	"time"
)

const completeBatchUpdate = `-- name: CompleteBatchUpdate :exec
UPDATE batch_update_log
SET completed_at = $1,
    status = 'completed',
    symbols_processed = $2,
    symbols_updated = $3
WHERE id = $4
`

type CompleteBatchUpdateParams struct {
	CompletedAt      sql.NullTime  `json:"completed_at"`
	SymbolsProcessed sql.NullInt32 `json:"symbols_processed"`
	SymbolsUpdated   sql.NullInt32 `json:"symbols_updated"`
	ID               int32         `json:"id"`
}

func (q *Queries) CompleteBatchUpdate(ctx context.Context, arg CompleteBatchUpdateParams) error {
	_, err := q.db.ExecContext(ctx, completeBatchUpdate,
		arg.CompletedAt,
		arg.SymbolsProcessed,
		arg.SymbolsUpdated,
		arg.ID,
	)
	return err
}

const deleteBatchUpdate = `-- name: DeleteBatchUpdate :exec
DELETE FROM batch_update_log
WHERE updater_name = $1
`

func (q *Queries) DeleteBatchUpdate(ctx context.Context, updaterName string) error {
	_, err := q.db.ExecContext(ctx, deleteBatchUpdate, updaterName)
	return err
}

const failBatchUpdate = `-- name: FailBatchUpdate :exec
UPDATE batch_update_log
SET completed_at = $1,
    status = 'failed',
    error_message = $2
WHERE id = $3
`

type FailBatchUpdateParams struct {
	CompletedAt  sql.NullTime   `json:"completed_at"`
	ErrorMessage sql.NullString `json:"error_message"`
	ID           int32          `json:"id"`
}

func (q *Queries) FailBatchUpdate(ctx context.Context, arg FailBatchUpdateParams) error {
	_, err := q.db.ExecContext(ctx, failBatchUpdate, arg.CompletedAt, arg.ErrorMessage, arg.ID)
	return err
}

const getLastBatchUpdate = `-- name: GetLastBatchUpdate :one
SELECT id, updater_name, started_at, completed_at, status, 
       symbols_processed, symbols_updated, error_message
FROM batch_update_log
WHERE updater_name = $1
  AND status = 'completed'
ORDER BY started_at DESC
LIMIT 1
`

func (q *Queries) GetLastBatchUpdate(ctx context.Context, updaterName string) (BatchUpdateLog, error) {
	row := q.db.QueryRowContext(ctx, getLastBatchUpdate, updaterName)
	var i BatchUpdateLog
	err := row.Scan(
		&i.ID,
		&i.UpdaterName,
		&i.StartedAt,
		&i.CompletedAt,
		&i.Status,
		&i.SymbolsProcessed,
		&i.SymbolsUpdated,
		&i.ErrorMessage,
	)
	return i, err
}

const startBatchUpdate = `-- name: StartBatchUpdate :one
INSERT INTO batch_update_log (updater_name, started_at, status)
VALUES ($1, $2, 'running')
RETURNING id
`

type StartBatchUpdateParams struct {
	UpdaterName string    `json:"updater_name"`
	StartedAt   time.Time `json:"started_at"`
}

func (q *Queries) StartBatchUpdate(ctx context.Context, arg StartBatchUpdateParams) (int32, error) {
	row := q.db.QueryRowContext(ctx, startBatchUpdate, arg.UpdaterName, arg.StartedAt)
	var id int32
	err := row.Scan(&id)
	return id, err
}
